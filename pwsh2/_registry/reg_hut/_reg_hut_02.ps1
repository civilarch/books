




$credential = Get-Credential
$registryKey = "HKLM:\software\microsoft\windows\currentversion\themes"
$computers = 'web02','dhcp01','mail01'

$result = Invoke-Command -ComputerName $computers -Credential $credential -ScriptBlock {

	$keys = Get-ChildItem -Recurse -Path $using:registryKey

	foreach ($key in $keys) {
		$obj = [pscustomobject]@{
			Name = $key.Name
			Properties = @{}
		}

		foreach ($property in $key.Property) {
			$obj.Properties[$property] = $key.GetValue($property)
		}

		Write-Output $obj
	}
}


foreach ($entry in $result) {
	Write-Verbose -Verbose ("{0} -- {1}" -f $entry.PSComputerName,$entry.Name)
	foreach ($key in $entry.Properties.Keys) {
		Write-Verbose -Verbose ("- $key == {0}" -f $entry.Properties[$key])
	}
}





# get-reg.ps1

Param ($key)

gi $key | % {
	$path = $_.PSPath
	$_.Property | % {
		$name = $_
		$data = Get-ItemProperty -LiteralPath $path -Name $name |
		Select-Object -Expand $name
		[pscustomobject]@{ value = $name; data = $data; key = $path }
	}
}

Get-ChildItem -Recurse $key | % { # won't process top key
	$path = $_.PSPath
	$_.Property | % {
		$name = $_
		# there is a key named "*" under hklm:\software\classes
		$data = Get-ItemProperty -LiteralPath $path -Name $name |
		Select-Object -Expand $name
		[pscustomobject]@{ value = $name; data = $data; key = $path }
	}
}

PS C:\Users\js2010> .\get-reg hkcu:\key1














# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





# :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 





